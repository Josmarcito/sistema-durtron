<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DURTRON - Sistema Administrativo</title>
    <meta name="description" content="Sistema administrativo DURTRON - Ventas, Inventario y Control Financiero">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
    <!-- MOBILE MENU TOGGLE -->
    <button class="menu-toggle" id="menu-toggle" onclick="toggleSidebar()">&#9776;</button>

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-brand">
            <div class="logo-icon">D</div>
            <div>
                <h1>DURTRON</h1>
                <span>Sistema Administrativo</span>
            </div>
        </div>
        <nav class="nav">
            <button class="nav-btn active" data-section="dashboard">
                Dashboard
            </button>
            <button class="nav-btn" data-section="catalogo">
                Catalogo
            </button>
            <button class="nav-btn" data-section="inventario">
                Inventario
            </button>
            <button class="nav-btn" data-section="ventas">
                Ventas
            </button>
            <button class="nav-btn" data-section="vendedores">
                Vendedores
            </button>
            <button class="nav-btn" data-section="cotizaciones">
                Cotizaciones
            </button>
            <button class="nav-btn" data-section="proveedores">
                Proveedores
            </button>
            <button class="nav-btn" data-section="requisiciones">
                Requisiciones
            </button>
        </nav>
        <div class="sidebar-footer">
            <button class="btn-logout" onclick="cerrarSesion()">Cerrar sesion</button>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        <header class="topbar">
            <div class="topbar-title">
                <h2 id="topbar-section-title">Dashboard</h2>
                <p>DURTRON &mdash; Innovacion Industrial</p>
            </div>
        </header>

        <main class="container">

            <!-- ============ DASHBOARD ============ -->
            <section id="dashboard" class="section active">
                <h2>Dashboard</h2>

                <div class="stats-grid">
                    <div class="stat-card accent">
                        <div class="stat-value" id="stat-no-facturado">$0</div>
                        <div class="stat-label">Ingreso No Facturado</div>
                    </div>
                    <div class="stat-card accent2">
                        <div class="stat-value" id="stat-facturado">$0</div>
                        <div class="stat-label">Ingreso Facturado</div>
                    </div>
                    <div class="stat-card" style="border-color:#27ae60;">
                        <div class="stat-value" style="color:#27ae60;" id="stat-total">$0</div>
                        <div class="stat-label">Ingreso Total</div>
                    </div>
                    <div class="stat-card" style="border-color:#f39c12;">
                        <div class="stat-value" style="color:#f39c12;" id="stat-utilidad">$0</div>
                        <div class="stat-label">Utilidad Bruta</div>
                    </div>
                </div>

                <div class="dashboard-charts">
                    <div class="card chart-card">
                        <h3>Distribucion de Ingresos</h3>
                        <div class="chart-container">
                            <canvas id="chart-ingresos"></canvas>
                        </div>
                    </div>
                    <div class="card chart-card">
                        <h3>Equipos Mas Vendidos</h3>
                        <div class="chart-container">
                            <canvas id="chart-top-equipos"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-bottom:1.5rem;">
                    <div class="card-header">
                        <h3>Ranking de Maquinas</h3>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width:40px">#</th>
                                    <th>Equipo</th>
                                    <th>Código</th>
                                    <th style="text-align:center">Unidades Vendidas</th>
                                    <th style="text-align:right">Ingreso</th>
                                    <th style="text-align:right">%</th>
                                </tr>
                            </thead>
                            <tbody id="top-equipos-tbody"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Historial Anual</h3>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Año</th>
                                    <th style="text-align:center">Ventas</th>
                                    <th style="text-align:right">No Facturado</th>
                                    <th style="text-align:right">Facturado</th>
                                    <th style="text-align:right">Total</th>
                                </tr>
                            </thead>
                            <tbody id="historial-anual-tbody"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ============ CATALOGO ============ -->
            <section id="catalogo" class="section">
                <h2>Catalogo de Equipos</h2>
                <p class="section-desc">Base de datos de modelos de maquinaria. Da de alta nuevos modelos aqui.</p>

                <div class="card">
                    <h3>Agregar Equipo al Catalogo</h3>
                    <form id="form-catalogo" class="form-grid">
                        <div class="form-group">
                            <label for="cat-nombre">Nombre del Equipo *</label>
                            <input type="text" id="cat-nombre" placeholder="Quebradora de Mandibulas" required>
                        </div>
                        <div class="form-group">
                            <label for="cat-marca">Marca</label>
                            <input type="text" id="cat-marca" placeholder="DURTRON">
                        </div>
                        <div class="form-group">
                            <label for="cat-modelo">Modelo</label>
                            <input type="text" id="cat-modelo" placeholder="JC-150">
                        </div>
                        <div class="form-group">
                            <label for="cat-version">Version</label>
                            <input type="text" id="cat-version" placeholder="1.0" value="1.0">
                        </div>
                        <div class="form-group">
                            <label for="cat-categoria">Categoria</label>
                            <select id="cat-categoria">
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="cat-precio-lista">Precio de Lista *</label>
                            <input type="number" id="cat-precio-lista" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="cat-precio-costo">Costo de Fabricacion</label>
                            <input type="number" id="cat-precio-costo" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label for="cat-potencia">Potencia Motor</label>
                            <input type="text" id="cat-potencia" placeholder="15 HP">
                        </div>
                        <div class="form-group">
                            <label for="cat-capacidad">Capacidad</label>
                            <input type="text" id="cat-capacidad" placeholder="5-20 TPH">
                        </div>
                        <div class="form-group">
                            <label for="cat-dimensiones">Dimensiones</label>
                            <input type="text" id="cat-dimensiones" placeholder="2.5 x 1.5 x 1.8 m">
                        </div>
                        <div class="form-group">
                            <label for="cat-peso">Peso</label>
                            <input type="text" id="cat-peso" placeholder="3500 kg">
                        </div>
                        <div class="form-group">
                            <label for="cat-apertura">Apertura</label>
                            <input type="text" id="cat-apertura" placeholder='3/8"'>
                        </div>
                        <div class="form-group">
                            <label for="cat-tamano-alimentacion">Tamaño Alimentación</label>
                            <input type="text" id="cat-tamano-alimentacion" placeholder='4"'>
                        </div>
                        <div class="form-group full-width">
                            <label for="cat-especificaciones">Especificaciones</label>
                            <textarea id="cat-especificaciones" rows="3"
                                placeholder="Especificaciones tecnicas adicionales..."></textarea>
                        </div>
                        <div class="form-group full-width">
                            <label for="cat-descripcion">Descripcion</label>
                            <textarea id="cat-descripcion" rows="2" placeholder="Descripcion del equipo..."></textarea>
                        </div>
                        <div class="form-actions full-width">
                            <button type="submit" class="btn btn-primary">Guardar en Catalogo</button>
                            <button type="reset" class="btn btn-secondary">Limpiar</button>
                        </div>
                    </form>
                </div>

                <div class="card">
                    <h3>Equipos en Catalogo</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Marca</th>
                                    <th>Modelo</th>
                                    <th>Version</th>
                                    <th>Categoria</th>
                                    <th>Precio Lista</th>
                                    <th>Costo Fab.</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="catalogo-tbody">
                                <tr>
                                    <td colspan="8" class="loading">Cargando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Modal Editar Equipo -->
            <div class="modal" id="modal-editar-equipo">
                <div class="modal-content modal-lg" style="max-width:90%;">
                    <div class="modal-header">
                        <h3>Editar Equipo del Catalogo</h3>
                        <button class="modal-close" onclick="closeModal('modal-editar-equipo')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="form-editar-equipo" class="form-grid">
                            <input type="hidden" id="edit-eq-id">
                            <div class="form-group">
                                <label for="edit-eq-nombre">Nombre del Equipo *</label>
                                <input type="text" id="edit-eq-nombre" required>
                            </div>
                            <div class="form-group">
                                <label for="edit-eq-marca">Marca</label>
                                <input type="text" id="edit-eq-marca">
                            </div>
                            <div class="form-group">
                                <label for="edit-eq-modelo">Modelo</label>
                                <input type="text" id="edit-eq-modelo">
                            </div>
                            <div class="form-group">
                                <label for="edit-eq-version">Version</label>
                                <select id="edit-eq-version">
                                    <option value="1.0">1.0</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="edit-eq-categoria">Categoria</label>
                                <select id="edit-eq-categoria">
                                    <option value="">Seleccionar...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="edit-eq-precio-lista">Precio de Lista *</label>
                                <input type="number" id="edit-eq-precio-lista" step="0.01" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="edit-eq-precio-costo">Costo de Fabricacion</label>
                                <input type="number" id="edit-eq-precio-costo" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label for="edit-eq-potencia">Potencia Motor</label>
                                <input type="text" id="edit-eq-potencia" placeholder="15 HP">
                            </div>
                            <div class="form-group">
                                <label for="edit-eq-capacidad">Capacidad</label>
                                <input type="text" id="edit-eq-capacidad" placeholder="5-20 TPH">
                            </div>
                            <div class="form-group">
                                <label for="edit-eq-dimensiones">Dimensiones</label>
                                <input type="text" id="edit-eq-dimensiones" placeholder="2.5 x 1.5 x 1.8 m">
                            </div>
                            <div class="form-group">
                                <label for="edit-eq-peso">Peso</label>
                                <input type="text" id="edit-eq-peso" placeholder="3500 kg">
                            </div>
                            <div class="form-group">
                                <label for="edit-eq-apertura">Apertura</label>
                                <input type="text" id="edit-eq-apertura" placeholder='3/8"'>
                            </div>
                            <div class="form-group">
                                <label for="edit-eq-tamano-alimentacion">Tamaño Alimentación</label>
                                <input type="text" id="edit-eq-tamano-alimentacion" placeholder='4"'>
                            </div>
                            <div class="form-group full-width">
                                <label for="edit-eq-especificaciones">Especificaciones</label>
                                <textarea id="edit-eq-especificaciones" rows="2"></textarea>
                            </div>
                            <div class="form-group full-width">
                                <label for="edit-eq-descripcion">Descripcion</label>
                                <textarea id="edit-eq-descripcion" rows="2"></textarea>
                            </div>
                        </form>

                        <!-- Partes Tecnicas -->
                        <div style="margin-top:1.5rem; border-top:1px solid rgba(255,255,255,0.1); padding-top:1rem;">
                            <h4>Partes Tecnicas del Equipo</h4>
                            <p style="color:#888; font-size:0.85rem;">Componentes y partes que conforman este equipo. Se
                                cargan automaticamente al crear una requisicion.</p>
                            <div id="edit-eq-partes-list" style="margin:10px 0;"></div>
                            <div style="display:flex; gap:8px; align-items:flex-end; flex-wrap:wrap; margin-top:8px;">
                                <div class="form-group" style="flex:2;margin:0;">
                                    <label>Nombre de la Parte</label>
                                    <input type="text" id="nueva-parte-nombre"
                                        placeholder="Ej: Polea principal, Motor 15HP">
                                </div>
                                <div class="form-group" style="flex:2;margin:0;">
                                    <label>Descripcion</label>
                                    <input type="text" id="nueva-parte-desc" placeholder="Descripcion opcional">
                                </div>
                                <div class="form-group" style="flex:0.5;margin:0;">
                                    <label>Cant</label>
                                    <input type="number" id="nueva-parte-cant" value="1" min="1">
                                </div>
                                <div class="form-group" style="flex:0.5;margin:0;">
                                    <label>Unidad</label>
                                    <input type="text" id="nueva-parte-unidad" value="pza">
                                </div>
                                <div class="form-group" style="flex:2;margin:0;">
                                    <label>Proveedor</label>
                                    <select id="nueva-parte-proveedor">
                                        <option value="">-- Sin asignar --</option>
                                    </select>
                                </div>
                                <button type="button" class="btn btn-primary" onclick="agregarParteEquipo()"
                                    style="height:38px;">+ Agregar Parte</button>
                            </div>
                        </div>

                        <div class="form-actions full-width" style="margin-top:1.5rem; display:flex; gap:10px;">
                            <button type="button" class="btn btn-primary" onclick="guardarEdicionEquipo()">Guardar
                                Cambios</button>
                            <button type="button" class="btn btn-secondary"
                                onclick="closeModal('modal-editar-equipo')">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ============ INVENTARIO ============ -->
            <section id="inventario" class="section">
                <h2>Inventario</h2>
                <p class="section-desc">Equipos fisicos en existencia. Agrega unidades del catalogo al inventario.</p>

                <div class="card">
                    <h3>Agregar al Inventario</h3>
                    <form id="form-inventario" class="form-grid">
                        <div class="form-group">
                            <label for="inv-equipo">Equipo del Catalogo *</label>
                            <select id="inv-equipo" required>
                                <option value="">Seleccionar equipo...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="inv-estado">Estado *</label>
                            <select id="inv-estado" required onchange="toggleNotaPiezas()">
                                <option value="">Seleccionar...</option>
                                <option value="Disponible">Disponible</option>
                                <option value="En Fabricacion">En Fabricacion</option>
                                <option value="Disponible - Faltan Piezas">Disponible - Faltan Piezas</option>
                            </select>
                        </div>
                        <div class="form-group full-width" id="nota-piezas-group" style="display:none;">
                            <label for="inv-nota-piezas">Piezas Faltantes</label>
                            <textarea id="inv-nota-piezas" rows="2"
                                placeholder="Ej: Falta polea principal, bandas de transmision..."></textarea>
                        </div>
                        <div class="form-group full-width">
                            <label for="inv-obs">Observaciones</label>
                            <textarea id="inv-obs" rows="2" placeholder="Notas adicionales..."></textarea>
                        </div>
                        <div id="inv-equipo-info" class="equipo-preview full-width" style="display:none;"></div>
                        <div class="form-actions full-width">
                            <button type="submit" class="btn btn-primary">Agregar al Inventario</button>
                        </div>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Inventario Actual</h3>
                        <div class="filter-bar">
                            <input type="text" id="inv-search" class="search-input" placeholder="Buscar...">
                            <select id="inv-filter-estado" class="filter-select">
                                <option value="">Todos los estados</option>
                                <option value="Disponible">Disponible</option>
                                <option value="En Fabricacion">En Fabricacion</option>
                                <option value="Disponible - Faltan Piezas">Disponible - Faltan Piezas</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Equipo</th>
                                    <th>Estado</th>
                                    <th>Precio Lista</th>
                                    <th>Fecha Ingreso</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="inventario-tbody">
                                <tr>
                                    <td colspan="6" class="loading">Cargando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Modal Cambiar Estado -->
            <div class="modal" id="modal-cambiar-estado">
                <div class="modal-content" style="max-width:450px;">
                    <div class="modal-header">
                        <h3>Cambiar Estado</h3>
                        <button class="modal-close" onclick="closeModal('modal-cambiar-estado')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="cambiar-estado-id">
                        <div class="form-group">
                            <label for="cambiar-estado-select">Nuevo Estado</label>
                            <select id="cambiar-estado-select" onchange="toggleNotaPiezasModal()">
                                <option value="Disponible">Disponible</option>
                                <option value="En Fabricacion">En Fabricacion</option>
                                <option value="Disponible - Faltan Piezas">Disponible - Faltan Piezas</option>
                            </select>
                        </div>
                        <div class="form-group" id="nota-piezas-modal-group" style="display:none;">
                            <label for="cambiar-estado-nota">Piezas Faltantes</label>
                            <textarea id="cambiar-estado-nota" rows="2"
                                placeholder="Ej: Falta polea principal..."></textarea>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="guardarCambioEstado()">Guardar</button>
                            <button class="btn btn-secondary"
                                onclick="closeModal('modal-cambiar-estado')">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ============ VENTAS ============ -->
            <section id="ventas" class="section">
                <h2>Registro de Ventas</h2>
                <div class="card">
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Equipo</th>
                                    <th>Cliente</th>
                                    <th>Vendedor</th>
                                    <th>Precio Venta</th>
                                    <th>Estado</th>
                                    <th>Entregado</th>
                                    <th>Facturado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="ventas-tbody">
                                <tr>
                                    <td colspan="9" class="loading">Cargando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ============ VENDEDORES ============ -->
            <section id="vendedores" class="section">
                <h2>Tablero de Vendedores</h2>

                <div class="card">
                    <h3>Agregar Vendedor</h3>
                    <form id="form-vendedor-catalogo" class="form-grid">
                        <div class="form-group">
                            <label for="vendedor-nombre">Nombre *</label>
                            <input type="text" id="vendedor-nombre" required placeholder="Nombre completo">
                        </div>
                        <div class="form-group">
                            <label for="vendedor-telefono">Telefono</label>
                            <input type="text" id="vendedor-telefono" placeholder="Ej: 618 123 4567">
                        </div>
                        <div class="form-group">
                            <label for="vendedor-email">Email</label>
                            <input type="email" id="vendedor-email" placeholder="correo@ejemplo.com">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Agregar Vendedor</button>
                        </div>
                    </form>
                </div>

                <div class="card">
                    <h3>Directorio de Vendedores</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Telefono</th>
                                    <th>Email</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="vendedores-catalogo-tbody">
                                <tr>
                                    <td colspan="5" class="loading">Cargando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <h3>Ranking de Ventas</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Vendedor</th>
                                    <th>Ventas</th>
                                    <th>Ingreso Neto</th>
                                    <th>Ingreso + IVA</th>
                                </tr>
                            </thead>
                            <tbody id="vendedores-tbody">
                                <tr>
                                    <td colspan="5" class="loading">Sin datos aun</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ============ COTIZACIONES ============ -->
            <section id="cotizaciones" class="section">
                <h2>Cotizaciones</h2>
                <p class="section-desc">Genera cotizaciones profesionales y descargalas como PDF.</p>

                <div class="card">
                    <h3>Nueva Cotizacion</h3>
                    <form id="form-cotizacion" class="form-grid">
                        <div class="form-group">
                            <label for="cot-vendedor">Vendedor *</label>
                            <input type="text" id="cot-vendedor" placeholder="Nombre del vendedor" required>
                        </div>
                        <div class="form-group">
                            <label for="cot-cliente">Cliente *</label>
                            <input type="text" id="cot-cliente" placeholder="Nombre del cliente" required>
                        </div>
                        <div class="form-group">
                            <label for="cot-empresa">Empresa</label>
                            <input type="text" id="cot-empresa" placeholder="Nombre de la empresa">
                        </div>
                        <div class="form-group">
                            <label for="cot-telefono">Telefono</label>
                            <input type="text" id="cot-telefono" placeholder="618 123 4567">
                        </div>
                        <div class="form-group">
                            <label for="cot-email">Email</label>
                            <input type="email" id="cot-email" placeholder="cliente@empresa.com">
                        </div>
                        <div class="form-group">
                            <label for="cot-iva">Incluir IVA (16%)</label>
                            <select id="cot-iva">
                                <option value="true">Si - Con IVA</option>
                                <option value="false">No - Sin IVA</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="cot-descuento">Descuento</label>
                            <select id="cot-descuento" onchange="toggleDescuento()">
                                <option value="0">No</option>
                                <option value="5">5%</option>
                                <option value="10">10%</option>
                                <option value="15">15%</option>
                                <option value="custom">Otro %</option>
                            </select>
                        </div>
                        <div class="form-group" id="cot-descuento-custom-group" style="display:none;">
                            <label for="cot-descuento-custom">Porcentaje de Descuento</label>
                            <input type="number" id="cot-descuento-custom" placeholder="Ej: 12" min="0" max="100"
                                step="0.5">
                        </div>
                        <div class="form-group">
                            <label for="cot-anticipo">Anticipo</label>
                            <select id="cot-anticipo" onchange="toggleAnticipo()">
                                <option value="0">No</option>
                                <option value="25">25%</option>
                                <option value="50">50%</option>
                                <option value="75">75%</option>
                                <option value="custom">Otro %</option>
                            </select>
                        </div>
                        <div class="form-group" id="cot-anticipo-custom-group" style="display:none;">
                            <label for="cot-anticipo-custom">Porcentaje de Anticipo</label>
                            <input type="number" id="cot-anticipo-custom" placeholder="Ej: 30" min="0" max="100"
                                step="0.5">
                        </div>
                        <div class="form-group full-width">
                            <label for="cot-direccion">Direccion</label>
                            <input type="text" id="cot-direccion" placeholder="Direccion del cliente">
                        </div>

                        <div class="full-width">
                            <h4 style="margin:1rem 0 0.5rem">Equipos a Cotizar</h4>
                            <div id="cot-items-container">
                                <div class="cot-item-row" data-index="0">
                                    <select class="cot-equipo-select" onchange="onEquipoSelect(this)">
                                        <option value="">Seleccionar equipo...</option>
                                    </select>
                                    <input type="number" class="cot-cantidad" value="1" min="1" placeholder="Cant"
                                        style="width:70px">
                                    <input type="number" class="cot-precio" step="0.01" min="0"
                                        placeholder="Precio unitario" style="width:150px">
                                    <input type="text" class="cot-desc" placeholder="Descripcion" style="flex:1">
                                    <button type="button" class="btn btn-sm btn-danger"
                                        onclick="removeCotItem(this)">X</button>
                                </div>
                            </div>
                            <div style="display:flex; gap:8px; margin-top:0.5rem;">
                                <button type="button" class="btn btn-sm btn-secondary" onclick="addCotItem()">+ Agregar
                                    equipo</button>
                                <button type="button" class="btn btn-sm" onclick="addCustomCotItem()"
                                    style="background:rgba(244,116,39,0.2); color:#F47427; border:1px solid #F47427;">+
                                    Agregar elemento personalizado</button>
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label for="cot-sobre-pedido">Sobre pedido</label>
                            <input type="text" id="cot-sobre-pedido" placeholder="Ej: Entrega en 4-6 semanas">
                        </div>

                        <div class="form-group full-width">
                            <label for="cot-notas">Notas adicionales</label>
                            <textarea id="cot-notas" rows="2" placeholder="Notas opcionales..."></textarea>
                        </div>
                        <div class="form-actions full-width">
                            <button type="submit" class="btn btn-primary">Generar Cotizacion</button>
                            <button type="reset" class="btn btn-secondary">Limpiar</button>
                        </div>
                    </form>
                </div>

                <div class="card">
                    <h3>Cotizaciones Generadas</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Folio</th>
                                    <th>Fecha</th>
                                    <th>Cliente</th>
                                    <th>Vendedor</th>
                                    <th>Total</th>
                                    <th>IVA</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="cotizaciones-tbody">
                                <tr>
                                    <td colspan="7" class="loading">Cargando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

        </main>

        <!-- MODAL COTIZACION PDF -->
        <div class="modal" id="modal-cotizacion">
            <div class="modal-content modal-xl">
                <div class="modal-header">
                    <h3>Vista de Cotizacion</h3>
                    <div>
                        <button class="btn btn-sm btn-primary" onclick="imprimirCotizacion()">Descargar PDF</button>
                        <button class="modal-close" onclick="closeModal('modal-cotizacion')">&times;</button>
                    </div>
                </div>
                <div class="modal-body" id="cotizacion-print-area"></div>
            </div>
        </div>

        <!-- MODAL DETALLE -->
        <div class="modal" id="modal-detalle">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Detalle del Equipo</h3>
                    <button class="modal-close" onclick="closeModal('modal-detalle')">&times;</button>
                </div>
                <div class="modal-body" id="modal-detalle-body"></div>
            </div>
        </div>

        <!-- MODAL VENTA -->
        <div class="modal" id="modal-venta">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3>Registrar Venta</h3>
                    <button class="modal-close" onclick="closeModal('modal-venta')">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="venta-equipo-info" class="equipo-preview"></div>
                    <form id="form-venta" class="form-grid">
                        <input type="hidden" id="venta-inv-id">
                        <div class="form-group">
                            <label for="venta-vendedor">Vendedor *</label>
                            <select id="venta-vendedor" required>
                                <option value="">Seleccionar vendedor...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="venta-cliente">Cliente *</label>
                            <input type="text" id="venta-cliente" required>
                        </div>
                        <div class="form-group">
                            <label for="venta-contacto">Contacto</label>
                            <input type="text" id="venta-contacto">
                        </div>
                        <div class="form-group">
                            <label for="venta-rfc">RFC</label>
                            <input type="text" id="venta-rfc">
                        </div>
                        <div class="form-group full-width">
                            <label for="venta-direccion">Direccion</label>
                            <input type="text" id="venta-direccion">
                        </div>
                        <div class="form-group">
                            <label for="venta-precio">Precio de Venta *</label>
                            <input type="number" id="venta-precio" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="venta-forma-pago">Forma de Pago</label>
                            <select id="venta-forma-pago">
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="venta-facturado">Se Facturo?</label>
                            <select id="venta-facturado">
                                <option value="false">No</option>
                                <option value="true">Si</option>
                            </select>
                        </div>
                        <div class="form-group" id="factura-num-group" style="display:none;">
                            <label for="venta-num-factura">Numero de Factura</label>
                            <input type="text" id="venta-num-factura">
                        </div>
                        <div class="form-group full-width">
                            <label for="venta-cuenta">Cuenta(s) Bancaria(s)</label>
                            <input type="text" id="venta-cuenta" placeholder="Ej: BBVA 50%, Banorte 50%">
                        </div>
                        <div class="form-group">
                            <label for="venta-anticipo-monto">Anticipo Inicial ($)</label>
                            <input type="number" id="venta-anticipo-monto" step="0.01" min="0"
                                placeholder="0 si sin anticipo">
                        </div>
                        <div class="form-group">
                            <label for="venta-anticipo-fecha">Fecha Anticipo</label>
                            <input type="date" id="venta-anticipo-fecha">
                        </div>
                        <div class="form-group full-width">
                            <label for="venta-notas">Notas</label>
                            <textarea id="venta-notas" rows="2"></textarea>
                        </div>
                        <div class="form-actions full-width">
                            <button type="submit" class="btn btn-success">Registrar Venta</button>
                            <button type="button" class="btn btn-secondary"
                                onclick="closeModal('modal-venta')">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal Editar Venta -->
        <div class="modal" id="modal-editar-venta">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3>Editar Venta</h3>
                    <button class="modal-close" onclick="closeModal('modal-editar-venta')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="form-editar-venta" class="form-grid">
                        <input type="hidden" id="edit-venta-id">
                        <div class="form-group">
                            <label for="edit-venta-vendedor">Vendedor</label>
                            <select id="edit-venta-vendedor">
                                <option value="">Seleccionar vendedor...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-venta-cliente">Cliente</label>
                            <input type="text" id="edit-venta-cliente">
                        </div>
                        <div class="form-group">
                            <label for="edit-venta-contacto">Contacto</label>
                            <input type="text" id="edit-venta-contacto">
                        </div>
                        <div class="form-group">
                            <label for="edit-venta-rfc">RFC</label>
                            <input type="text" id="edit-venta-rfc">
                        </div>
                        <div class="form-group full-width">
                            <label for="edit-venta-direccion">Direccion</label>
                            <input type="text" id="edit-venta-direccion">
                        </div>
                        <div class="form-group">
                            <label for="edit-venta-precio">Precio Venta</label>
                            <input type="number" id="edit-venta-precio" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label for="edit-venta-forma-pago">Forma de Pago</label>
                            <input type="text" id="edit-venta-forma-pago">
                        </div>
                        <div class="form-group">
                            <label for="edit-venta-facturado">Facturado</label>
                            <select id="edit-venta-facturado">
                                <option value="false">No</option>
                                <option value="true">Si</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-venta-num-factura">No. Factura</label>
                            <input type="text" id="edit-venta-num-factura">
                        </div>
                        <div class="form-group full-width">
                            <label for="edit-venta-cuenta">Cuenta(s) Bancaria(s)</label>
                            <input type="text" id="edit-venta-cuenta" placeholder="Ej: BBVA 50%, Banorte 50%">
                        </div>
                        <div class="form-group">
                            <label for="edit-venta-entregado">Entregado</label>
                            <select id="edit-venta-entregado">
                                <option value="false">No</option>
                                <option value="true">Si</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-venta-estado">Estado</label>
                            <select id="edit-venta-estado">
                                <option value="Anticipo">Anticipo</option>
                                <option value="Liquidado">Liquidado</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label for="edit-venta-notas">Notas</label>
                            <textarea id="edit-venta-notas" rows="2"></textarea>
                        </div>
                        <!-- Anticipos registrados -->
                        <div class="form-group full-width">
                            <h4 style="margin:0.5rem 0;">Historial de Anticipos</h4>
                            <div id="edit-venta-anticipos-list" style="max-height:200px;overflow-y:auto;"></div>
                            <button type="button" class="btn btn-sm btn-primary" style="margin-top:0.5rem;"
                                onclick="abrirAgregarAnticipo()">+ Agregar Anticipo</button>
                        </div>
                        <div class="form-actions full-width">
                            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                            <button type="button" class="btn btn-secondary"
                                onclick="closeModal('modal-editar-venta')">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal Agregar Anticipo -->
        <div class="modal" id="modal-agregar-anticipo">
            <div class="modal-content" style="max-width:500px;">
                <div class="modal-header">
                    <h3>Agregar Anticipo</h3>
                    <button class="modal-close" onclick="closeModal('modal-agregar-anticipo')">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="anticipo-venta-id">
                    <div class="form-group">
                        <label for="anticipo-monto">Monto *</label>
                        <input type="number" id="anticipo-monto" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="anticipo-fecha">Fecha</label>
                        <input type="date" id="anticipo-fecha">
                    </div>
                    <div class="form-group">
                        <label for="anticipo-comprobante">Comprobante (PNG/screenshot)</label>
                        <input type="file" id="anticipo-comprobante" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="anticipo-notas">Notas</label>
                        <input type="text" id="anticipo-notas" placeholder="Ej: Transferencia BBVA">
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-success" onclick="guardarAnticipo()">Registrar Anticipo</button>
                        <button class="btn btn-secondary"
                            onclick="closeModal('modal-agregar-anticipo')">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============ PROVEEDORES ============ -->
        <section id="proveedores" class="section">
            <h2>Proveedores</h2>
            <p class="section-desc">Gestiona tus proveedores y contactos comerciales.</p>

            <div class="card">
                <h3>Registrar Proveedor</h3>
                <form id="form-proveedor" class="form-grid" onsubmit="event.preventDefault();">
                    <div class="form-group">
                        <label>Razon Social *</label>
                        <input type="text" id="prov-razon" required placeholder="Nombre de la empresa">
                    </div>
                    <div class="form-group">
                        <label>Contacto</label>
                        <input type="text" id="prov-contacto" placeholder="Nombre del contacto">
                    </div>
                    <div class="form-group">
                        <label>Correo</label>
                        <input type="email" id="prov-correo" placeholder="email@proveedor.com">
                    </div>
                    <div class="form-group">
                        <label>Telefono</label>
                        <input type="text" id="prov-telefono" placeholder="618 123 4567">
                    </div>
                    <div class="form-group">
                        <label>WhatsApp</label>
                        <input type="text" id="prov-whatsapp" placeholder="52618XXXXXXX">
                    </div>
                    <div class="form-group">
                        <label>Medio Preferido</label>
                        <select id="prov-medio">
                            <option value="WhatsApp">WhatsApp</option>
                            <option value="Email">Email</option>
                            <option value="Telefono">Telefono</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label>Notas</label>
                        <textarea id="prov-notas" rows="2" placeholder="Notas adicionales..."></textarea>
                    </div>
                    <div class="form-actions full-width">
                        <button type="submit" class="btn btn-primary">Guardar Proveedor</button>
                    </div>
                </form>
            </div>

            <div class="card">
                <h3>Lista de Proveedores</h3>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Razon Social</th>
                                <th>Contacto</th>
                                <th>Correo</th>
                                <th>Telefono</th>
                                <th>WhatsApp</th>
                                <th>Medio</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tabla-proveedores">
                            <tr>
                                <td colspan="7" class="loading">Cargando...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ============ REQUISICIONES ============ -->
        <section id="requisiciones" class="section">
            <h2>Requisiciones</h2>
            <p class="section-desc">Crea y envía hojas de requisicion de materiales a proveedores.</p>

            <div class="card">
                <div class="card-header">
                    <h3>Requisiciones</h3>
                    <button class="btn btn-primary" onclick="openModal('modal-requisicion')">+ Nueva
                        Requisicion</button>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Folio</th>
                                <th>No. Control</th>
                                <th>Proyecto / Equipo</th>
                                <th>Estado</th>
                                <th>Fecha</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tabla-requisiciones">
                            <tr>
                                <td colspan="6" class="loading">Cargando...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- MODAL: Nueva Requisicion -->
        <div class="modal" id="modal-requisicion">
            <div class="modal-content modal-lg" style="max-width: 95%;">
                <div class="modal-header">
                    <h3>Nueva Requisicion - Hoja de Control</h3>
                    <button class="modal-close" onclick="closeModal('modal-requisicion')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="form-requisicion" onsubmit="event.preventDefault();">
                        <div class="form-row" style="display:flex; gap:1rem; margin-bottom:1rem;">
                            <div class="form-group" style="flex:2">
                                <label>PROYECTO / ORDEN DE PRODUCCIÓN *</label>
                                <select id="req-equipo" required onchange="cargarPartesRequisicion(this.value)">
                                    <option value="">-- Seleccionar equipo del catalogo --</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex:1">
                                <label>No. CONTROL</label>
                                <input type="text" id="req-no-control" placeholder="Ej: RM01-00">
                            </div>
                        </div>
                        <div class="form-row" style="display:flex; gap:1rem; margin-bottom:1rem;">
                            <div class="form-group" style="flex:1">
                                <label>ÁREA</label>
                                <input type="text" id="req-area" value="Departamento de Ingeniería"
                                    placeholder="Área solicitante">
                            </div>
                            <div class="form-group" style="flex:1">
                                <label>PROVEEDOR PRINCIPAL (Opcional)</label>
                                <select id="req-proveedor">
                                    <option value="">-- Varios / Sin definir --</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row" style="display:flex; gap:1rem; margin-bottom:1rem;">
                            <div class="form-group" style="flex:1">
                                <label>EMITIDO POR</label>
                                <input type="text" id="req-emitido" placeholder="Nombre de quien solicita">
                            </div>
                            <div class="form-group" style="flex:1">
                                <label>APROBADO POR</label>
                                <input type="text" id="req-aprobado" placeholder="Nombre de quien autoriza">
                            </div>
                            <div class="form-group" style="flex:1">
                                <label>REVISADO POR</label>
                                <input type="text" id="req-revisado" placeholder="Nombre de quien revisa">
                            </div>
                            <div class="form-group" style="flex:1">
                                <label>REQUERIDO POR</label>
                                <input type="text" id="req-requerido" placeholder="Nombre de quien requiere">
                            </div>
                        </div>
                        <div class="form-group full-width">
                            <label>NOTAS / OBSERVACIONES</label>
                            <textarea id="req-notas" rows="2" placeholder="Instrucciones adicionales..."></textarea>
                        </div>

                        <div class="form-group full-width">
                            <label>Partidas / Componentes</label>
                            <div class="items-editor">
                                <div class="items-header"
                                    style="display:grid; grid-template-columns: 0.3fr 2fr 1.2fr 1.5fr 0.5fr 1fr 0.3fr 1fr 1fr 40px; gap:5px; font-size:0.75rem; margin-bottom:5px; font-weight:bold; background:rgba(255,255,255,0.05); padding:5px; border-radius:4px;">
                                    <span>No.</span>
                                    <span>Descripcion / Parte</span>
                                    <span>Proveedor</span>
                                    <span>Comentarios</span>
                                    <span>Cant</span>
                                    <!-- Unidad removed -->
                                    <span>Precio U.</span>
                                    <span>IVA</span>
                                    <span>Subtotal</span>
                                    <span>Total</span>
                                    <span></span>
                                </div>
                                <div id="req-items-container" class="items-list-container">
                                    <!-- Items dinámicos aquí -->
                                </div>
                                <div
                                    style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                                    <button type="button" class="btn btn-secondary" onclick="addReqItem()">+ Agregar
                                        Parte</button>
                                    <div style="font-size:0.9rem; font-weight:bold;">
                                        TOTAL GENERAL: <span id="req-total-general"
                                            style="color:var(--accent);font-size:1.1rem;">$0.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions full-width" style="margin-top:1rem;">
                            <button type="submit" class="btn btn-primary">Guardar Requisicion</button>
                            <button type="button" class="btn btn-secondary"
                                onclick="closeModal('modal-requisicion')">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- MODAL: Detalle Requisicion -->
        <div class="modal" id="modal-req-detalle">
            <div class="modal-content modal-xl" style="max-width:95%;">
                <div class="modal-header">
                    <h3 id="req-detalle-titulo">Requisicion</h3>
                    <button class="modal-close" onclick="closeModal('modal-req-detalle')">&times;</button>
                </div>
                <div class="modal-body" id="req-detalle-body">
                    <p class="loading">Cargando...</p>
                </div>
            </div>
        </div>

        <footer class="footer">
            <p>Av. del Sol #329, Durango, Dgo. | Tel: 618 134 1056</p>
            <p>&copy; 2025 DURTRON &mdash; Innovacion Industrial</p>
            <p style="margin-top:0.3rem;opacity:0.6;">Desarrollado por Josmar Hinojosa y Antigravity</p>
        </footer>

    </div><!-- /main-content -->

    <div id="toast-container"></div>
    <script src="logo_data.js"></script>
    <script src="script.js?v=20240218_1100"></script>
</body>

</html>